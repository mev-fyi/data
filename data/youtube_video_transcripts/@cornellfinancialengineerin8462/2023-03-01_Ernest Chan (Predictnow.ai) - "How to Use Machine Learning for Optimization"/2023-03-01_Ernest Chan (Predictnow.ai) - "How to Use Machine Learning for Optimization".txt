okay so uh so everybody welcome to this uh uh UBS CFM uh Ai and data analytics seminar I'm really happy to have Ernest Chan with us we've been chatting a little bit and he kind of reminded me of his trajectory sort of a PhD at Cornell then working at IBM then uh then writing a book uh on quantitative strategies and and you're developing your own algorithmic business which he then did with the hedge fund and now he's uh he started a a new company uh predict now and um and today he's going to be talking to us about conditional portfolio optimization a topic that uh that is really interesting to all of us uh because we're always hungry for uh more portfolio optimization beyond your your mean variants and and I think this is going to be a very exciting talk so Ernest thank you for coming and the floor is yours thank you very much for inviting me Sasha great to be here um and uh thank you everyone for coming to this webinar um so let's set up the problem um first uh you know I I'm I'm sure that many of you have um heard of portfolio optimization mainly as a method to find the best Capital allocation across different components of a portfolio now that portfolio could be a portfolio of stocks could be a portfolio of Futures in fact it could be a portfolio of trading strategies or a portfolio or portfolios it's quite General so is this at the highest level a resource allocation method so the traditional way of doing it um you know actually earn the um the person who invented it a Nobel Prize and of course I was I'm referring to Markowitz uh Harry Markowitz he invented this mean variance optimization which is effectively a quadratic Optimizer the only input would be the uh the average returns of each of the components of the portfolio as well as the covariance of returns now naturally the question arose is that you know you can of course find the most optimal portfolio using these inputs in the past but who is to say that that portfolio is going to be optimal in the future right and and you know every um investment advisor would would warn you that past performance is no guarantee of future returns and so we we face with a dilemma here now in over the last few decades there are many many attempts to improve over this um basic portfolio optimization methods you hear about um with parity for example you hear about even hierarchical risk parity and you hear about different effort of using machine learning to generate expected returns rather than using historical returns as an input to the mean variance method but effectively all of these methods uses past historical returns or or past information as an input and none of which really take into account the problem that I'm going to talk about which is regime changes so you know and regime changes which I'm going to talk shortly we really means that well the market is is not stationary it is subject to multiple different regimes some of which you don't even have a name for and how could we we expect that a portfolio that was optimal let's say in the past one year if you use one year look back later to optimize it going to be optimal not to mention the next year but the next month um a clear example uh was let's say you're trying to apply mean variant circumcision in January 2022 and using one year look back no doubt your U.S stock portfolio will be overweight on stocks like GameStop or AMC and so forth and it will be probably underweight on Exxon Mobil and of course that portfolio will be the worst possible uh it can't be less optimal than you know if it probably less optimal than an equal weighted portfolio going into 2022 when all the high flying stocks of 2021 fail to Earth and all the neglected stocks like Exxon Mobil became the best performer so you know regime changes has presented one of the main challenge to the traditional portfolio optimization method and so what we think about you know the way we approach it is how can machine learning help to deal with this problem how can machine learning make use of big data and by Big Data I mean all the variables that we can observe across different markets let's say you are optimizing a U.S stock portfolio can we look at how all your futures behave how interest rate behave how macroeconomic variables behave taking whatever it is the current context and use that information to improve our optimal uh our promo portfolio to improve our results how do we do that and that is the main focus of this technique that we invented called conditional portfolio optimization so I mentioned uh the main challenge is changing regime so what exactly do I mean by regimes and I should first apologize to the um to the very quantitative um practitioner out there that the regime that we're thinking about is not well defined it's not uh the typical uh well-defined regime where oh you know we have a a free state model or we have a 10 State model we don't even have a discrete number of regimes that in our mind in this model we don't Define exactly what the regime is we don't even know we don't even have discrete number of regimes um so you know typically when people talk about regime they talk about feasible regimes bull market by market flat Market shopping market risk on resolve inflationary deflationary these regimes are well defined and they are discreet you can count them they're countable and it is you know hard to predict right I mean if I could predict when the bear Market is going to come or where the bull market will come uh portfolio concession is the last of my worries I will immediately become a directional Futures Trader and you know who cares about a portfolio just trade the index Futures and you'll be uh all done or if if I can predict exactly when in private facility is going to go up um I would just trade a VX future and be done with it there's no need to worry about portfolio but problem is these kind of feasible regimes are very hard to predict um and there's a lot of Arbitrage going on that make it uh if you can pre-take it usually the edge you go pretty quickly now they are also hidden regimes and I know whenever you mention hidden regime people think oh hidden Markov model no no we are not even talking about those hidden regime we're talking about um regimes hidden regimes that you cannot count and you cannot Define for example um how do you call a regime where a large family office is liquidating how do you call a regime where there are a lot of retail Traders buying core options on stocks that were mentioned on Reddit how do you call a regime where you have a wall somewhere and oil prices are going up because of that and at the same time you have you know a lot of demand that are pent up demand due to covet restrictions you know you can't even come up with a name to it and that's clearly not a discrete regime this is the kind of regime that can only be sort of implicitly defined by a large number of variables like oh high inflation is one variable uh interest rate certainly another variable all price and maybe there are some discrete variable that you can use for defining it such as is there a major war or is there no major war is there pandemic or no pandemic you know it's kind of um a state where we don't know how to define it and there's no discrete number but you can at least um you measure it using a large number of variables and that is the kind of regime that we're talking about and that is the kind of regime that are constantly changing uh that ruined uh classical methods of optimization um so actually I'm going to skip uh the the the the the emphasis on regime because as I said that the problem with with these machines is that it's hard to predict and it is actually not well defined but they are but very useful as a mental model of understanding why optimization fail uh in finance as opposed to perhaps a a toy problem that one studies in a PhD in operation research and so now uh when we were thinking about you know how you know the one of one of the reason that we come up with this optimization method is actually because I was um I I was running a hedge fund and we have a trading strategy uh that has a few parameters like most trading strategies um and we find that this training strategy uh work very well under certain Market condition and work poorly under others and we said well that is too bad how do we adapt the parameters of this training strategies to you know what you we would understand is the regime um and you know you the typical way that people would do it is let's just use a walk forward optimization you know use a rolling let's say six month period and find out the parameters that are work best for the string chart generally the highest drop ratio for this training strategy in the last six months and continuously uh adapt this training parameters um as this six month period move forward right it's a walk forward optimization the problem uh with that approach is exactly the same as the portfolio pronunciation problem because of uh you're always Looking Backward and there's no reason why the last six months uh is the same as the next six months and usually It Isn't So this workforward optimization completely doesn't work for us and so we come up with a way to use machine learning to adapt these parameters how well first of all let's to be clear we are looking at a supervised learning problem right so you you know in a supervised machine learning um problem there is always a Target variable usually called a label so this is the parameter that we wanted to optimize or in this case maximize sharp ratio let's say the future let's say one month sharp ratio of trading strategy or the future one month return we use that as the label for the supervised learning problem and then the input would be you know you know in in common machine learning problems the features or predictors or the regressors if you are linear regression person um and that would be all these market and macroeconomic variables that measure the current regime as I said the regime is undefined so we just need a lot of variables to capture aspects of it but what is most interesting is that we also add to this feature Factor the strategy parameters and that is something that I haven't seen people use so that is kind of intriguing that you have a feature factor that part of it is determined by the environment the market and part of it is what we call control variables those are the features that the human can change the the the trader can change and combining the two form an input to this supervised learning algorithm and obviously um if you have let's say 10 years of data all these uh you know the daily values of this macroeconomic variables are defined by the environment but on each day you can potentially have millions of combinations of these um control variables these parameters that you define so the data set the the training data set can actually be enormous for a simple problem like that and so but assuming that somehow you am able to um format this data and train a machine learning algorithm whether it's a neural network or a gradient processing entry that doesn't matter really it's just whatever a regression algorithm that you can you can put your hands on you train this model with all this enormous amount of data and then when it comes time to actual optimization all you need to do and I put that in quote quote all you need to do is to do an exhaustive search about various combination of these parameters uh and find a set that give you the maximum shop ratio and that's it so that's the gist of a a p cursor to conditional portfolio optimization we call that conditional parameter optimization now um a simple example might illustrate better you have a pool in Japan being referring strategy on a pair of ETF and one of the parameters is the head ratio namely how many shares of GDX to trade versus a share of GLT another parameter might be the entries threshold of the Red Bull in Japan meaning at how many multiples of the moving standard deviation are you going to enter into this minivering strategy and then of course another variable would be another parameter might be the look back to compute the moving standard deviation and moving average right so three parameter optimization very a simple model toy strategy and um the feature table will be will look like this so as I said there are all these so-called Market features you know money flow on the GLD ETF manifold GDX um the you know technical indicators on GLD technical indicators and GDX and so forth you can have hundreds of them as many as you like and then you have these variables the three parameters that I just defined the hatch ratio the entry threshold and the look back and together these are called control features and these are called Market features together they form one row one sample for input into your training and if you change the control variables or the parameters slightly you will get um you know let's say look back on from 30 to 60 you get another sample you can see that you you know this is you don't suffer from a lack of data you suffer from too much data in this problem but that's okay uh we'll figure out how to deal with that um uh later but actually I I forgot to mention peace feel free to ask any questions um while I'm speaking on the chat window you know I'm happy to answer it uh in real time uh instead of waiting to end because usually nobody remember what the question is when if you wait until the end so please yeah you can use the Q a for that so yeah just that that's what we're great great thank you yeah okay so um all right so that is a um you know that what we we come up with as a way to optimize parameters using machine learning and we had some success with that and then what we thought is wait a minute um a portfolio a capital allocation on a portfolio is just a bigger version of this parameter optimization because um you know you know you can think of the capital allocation of this component of a portfolio as just a whole bunch of trading parameters right and so you know this method we thought can be applied to portfolio uh optimization as well although instead of three parameters you might now have hundreds or even thousands of parameters or optimized you you've got a much bigger problem you can even higher dimensional problem to deal with but conceptually it's the same as param componentization so let's see how we can use apply this method to this larger problem now I I mentioned earlier that there are these are already traditional methods risk parity minimum variance and maximum sharp when I say macro as I met I meant maximum shop looking at the tangency portfolio these are methods that do not use machine learning and these are all the solutions that happen to fall on um the efficient Frontier Okay so the common theme of all these classical portfolio optimization methods as I mentioned is that they use past returns and covariance of returns as input only none of them take into account the current market condition they do not take into account technical indicators they do not take into account fundamental indicators they do not even take into account macroeconomic indicators right they they could not care about all these variables that measure the current market so obviously they are unable to adapt to the regime so what do we do well what we do is that we use the same method as we um uh we did that we applied to parameter optimization to tackle this problem we use big data for the input as the input features um we use implicit prediction of hidden regimes we do not explicitly take a regime before we go on and we look for the portfolio that is optimal under the current market condition not the operative that was optimal in the last six months as a um uh you know as a solution of this um a couple questions from the Q a um um the first one is are the labels obtained using simulation so or are you looking forward I'm not sure no no so um for each hypothetical portfolio I mean typically the portfolio manager present the portfolio let's say they want to long this 10 Stock and short these 10 stocks right so the the tickers of this portfolio are already defined we are not trying to suggest what stock you should buy and what stock you should shop you define that already as a portfolio manager so the only Freedom we have is how much Capital how much weight we should apply to each of these stocks and so given a particular hypothetical um allocation Capital allocation you get a realized return going forward so it's not a simulation because based on Market data you would know exactly given this particular Capital allocation and this portfolio what would be the future uh forward you know one month shop Ratio or the forward one month return so it's not um it's not a simulation per se but the portfolio Capital allocation itself of course is a it's a proposal right you you we try different proposals and given a particular proposal the return can be computed from actual Market data so it's not really a simulation um another related question we have is um does that mean with each set of control variables we need to rerun the back test to generate the labels that's right in the in the context of a trading strategy that is exactly what you have to do but of course in the context of a portfolio optimization is fairly easy because uh we are just holding these positions with this Capital so it's fairly easy to say oh if I change the capital location what is going to be the return or the sub ratio of this portfolio easy just you know do another thought make dot um product and and out comes the uh the Future Shop ratio of future returns right yeah okay okay thank you um so um now um at this point maybe I'll talk a little bit about what features you use so you know essentially the features can be anything uh we can use any sort of Time series feature and it is important to emphasize that we do not use cross-sectional features in this method we do not care about the let's say the um particular characteristic of each stock in the portfolio we don't care about their earnings we don't care about their 10-day return we don't care about their 30-day volatility it's completely different from the traditional optimization method uh let's say mean fairness because in mean fairs the cross-sectional features of the components are Parma you know that you you need to know that mean return you need to know the Corvette return whereas in this method we don't care at all these cross-sectional features what we care is the characteristic of the portfolio as a whole or the characteristic of the market regime as a whole things that measure for example the um the farmer Finance factors and things that measure the um imply volatility of the index things that measure whether oil prices are going up things that measure where the interest rate is going up so these are these Global features that we use we use no cross-sectional features now it might seem strange that um you know how it is possible that you can ignore the particular characteristics of the component and Achieve optimal portfolio but let's think about it uh going back again several decades ago um David Fusion farmer and David French came up with the primer fan three Factor model right so if you remember the family friend three Factor model says you know you have Market return you have the outperformance of the value over both stocks and our performance of small cap over uh large caps are just these three returns can explain a large part of any portfolio's return it's uh that's what they call the farmer fan Factor model now I emphasize the the term explain it does not it was not meant to be a predictive model the family reference model is an explanatory model because this is a linear model that regresses the return of a portfolio versus their contemporaneous factors there's no predictive component to it and supposedly it has a good R square so at least as an explanation it's pretty good now but what if we run the factors in a predictive manner we lack the factors one period so that we use contemporary factors to predict the future one period uh portfolio return let's say so that make it into protective model um and at least conceptually that's what we are doing right so we are using contamaraneous factor and feed it into a machine learning model to try to predict the next period return or sharp ratio conceptually is the same now of course we use a lot more factors hundreds of them whereas farmer fans of course use a three factor or five Factor but conceptory is the same thing we use a non-linear model a machine learning model and timer French use a simple linear regression model but that's just a matter of complexity it's not a matter of principle the principle is the same but the problem is the family friends predictive model has very bad R square I tried I actually use that as a homework exercise for my master Financial engineering class at Northwestern and everybody got a very bad R square they were very depressed for a day because they thought they did something wrong in their homework but they did it was correct it was a terrible model for prediction not a very a good model for explanation but a terrible model for prediction so can machine learning improve this prediction can more factors improve this prediction perhaps it can perhaps you can but the interesting thing is it doesn't have to and that is one of the insights we gained from from this technique is that because our objective is not predicting returns per se it is to rank returns in an optimization you do not need to make predictions Fair accurately and for example you know if you can say if you say that hey here um uh allocation of 20 to Google and 60 Microsoft and 20 of Apple let's say generate an expected uh sub ratio of um one for the next 30 days uh and um on the other hand is different allocation of 25 60 50 generated expected start ratio of 0.5 uh in the next period you know and we will realize stop ratio could be hey negative one versus negative three it's not only is the magnitude wrong but the sign could be completely wrong in the prediction and yet as long as the order of the predicted outcome remain correct we are in business because you only need to pick the most the highest rank um sharp ratio the portfolio of the highest rank shop ratio to be the optimal portfolio so you you might have heard in other papers uh published in 2020 that is along the similar lines I can't remember the name of that paper right now but it will be a reference you know in our upcoming white paper but essentially ranking in most Financial applications are more important than actual regression or prediction and that can be applied to a portfolio organization too we only need to be able to rank different Capital allocations correctly in order to accomplish optimization and that is something that traditional um classical optimization method did not um consider now you know there have been as I mentioned earlier many attempts in using machine learning for portfolio organization right there's many attempts but typically what those attempts try to do is you know they create a machine learning model to predict the cross-sectional returns of the component hey Google likely to have one percent return and Microsoft might have minus three percent return and apple is going to have five percent return in the next month that would be the outcome of the traditional machine learning Alpha model the problem with using that in the optimization is that you know unless this return prediction are accurate the magnitude and the sign are accurate uh it results in a garbage in garbage out situation if you are had a large error bar in this kind of return prediction and using that as an input to the quadratic Optimizer without in a portfolio that is also far from optimal it is not very error tolerant the quadratic optimizers as many many books have written have said for example um Professor Marcus or practice book had outlined some of the problem Professor Andrew ing's book he used to teach at Columbia I think now he's at back walk had listed numerous problems and the main problem is the instability of the quadratic Optimizer any error in the expected return generate hugely different portfolio that's very is very unstable uh particularly because you have to invert The covariance Matrix but the CPO method kind of sidestep of that we don't even require any cross-sectional feature we don't require any returns as an input not to mention ex you know a alpha model that predict returns we don't care any of that our our intellectual um Godfather is really the framer fan free Factor model which does not consider any cross-section information at all and so by doing that and combining with the notion that ranking is more important than prediction or regression we come up with an optimal solution that is much more stable against errors in any sort of step in the program you know machine learning is not very precise to be fine if anyone who has tried chat gbt could could testify to that it's not very precise despite all the um enthusiasm about it but we are but using this particular method we are able to tolerate tremendous errors in machine learning prediction because of ranking and that is I think the uh one of the um uh the the Insight that we gained from trying this method so um uh so you know this slide essentially just basically say the same thing uh that's what what I just said uh now here I have uh I think there's a question let me answer that before I go on to some of the the numbers um question is my understanding of The Game Stop phenomenon is that it's a lot of Behavioral Finance um yes indeed civil methods will pass against similar type of Behavioral Finance okay so that's a very interesting question so um even though the cause of the GameStop phenomenon might be behavioral Finance however um the effect of that kind of behavior can be measured using certain familiar Market metrics one example would be the net Delta of options buying activities and that is actually one of the features we use um it's not a secret or anything because we actually write a blog post on it there are measures of how much buying of uh core options in the market that is an indication of how much uh you know what what's the sort of the um demanding level of retail investor and that is one of the the metric that that goes into this um this CPO model as one of the features so we are taking into account that except that we don't use anything that is the core course of the phenomenon you know we use the the effect of that phenomenon as an input so another question is um do you recommend historical ranking of returns and input features um I'm actually not completely sure what historical ranking of returns um do you mean uh ranking of cross-sectional returns of the of the components so I'm not completely sure I understand the um the question maybe we can leave it till the end if we have more time to consider it okay so um let's look at some concrete results you know we apply to an unconstrained optimization of an S P 500 portfolio over uh 10 years the outer sample result is satisfactory um it does beat the microwaves method uh three times in terms of sub ratio um we apply it to a crypto portfolio of eight uh cryptocurrencies we are allowed to short if iOS long and again this is an unconstrained optimization it also outperformed the mean variance method um we apply it to a descriptive portfolio where you're using some features of you know some uh crypto features or or that were yeah we tried both blockchain or or was it a simple were you just looking at uh I don't know macroeconomic data or like Yeah we actually tried both we have crypto features that are generated for Market microstructure variables um and uh actually they underperform the traditional uh Market features that we use on traditional assets which is a surprise to us actually yeah and um we also um uh look at a um a Canadian ETF um you know you say um perspective client of ours evolve ETF they created a metaverse ETF match gtf that uh hold 24 U.S stocks that has something to do with the metaverse and in this case it's a constrained optimization so you can only allocate from 0.5 to 10 to each component and with that we have a outer sample testing period that straddles the pool and the bear Market you know middle you know August of 2021 to July of 2022 and you can see that comparing with all these other methods for example uh if you just use the knife equal weight allocation you know you get a very bad return minus 29 percent and if you use mean various optimization this is kind of a good example of what was optimal in the past can be very unoptimal in the future it actually performed worse than the equal weight method because of the regime change and the mean value minimum variant portfolio or minimum 40 portfolio for much better um but of course the CBO method performed better because in 2021 the CBO method was able to allocate more weight to growth stocks whereas in the um or actually larger cap stock whereas it allocates less Capital to um large caps sorry okay more Capital the small caps are in 2001 and more Capital to large cap stock in 202 so it was able to beat the minimum variance portfolio in 2021 and was able to beat the markets portfolio in 2022. uh so it is important to understand that the CBO method does not always outperform classical method in any period if you take any one year you say oh wait you know this unperformed Market what are you talking about or hey look at this period it will underperform the minimum variance portfolio but the problem is the whole point of CBO is that it's adaptive so you know in the beginning of a test period you have to choose one method in the classical method are you going to choose maximum shop or are you going to choose minimum volatility or are you going to choose equal weight once you fix on that method that's what you're going to suffer whether it's bull market or bear Market whereas for CBO it is not fixed it is adaptive so it was able to outperform some methods um in some period and on the on average it up it outperforms um all these classical methods over the long term because it was able to adapt to the market regime uh and unlike the other ones so a couple questions related to transaction costs so people want one question that asks uh can you explain what the turnover is and uh if you can and the other question is do you account for commissions um essentially they're twice they're similar questions yes so um this I should emphasize that this um performance number do not take into account transaction cost and the reason is that first of all the rebalance period is um one month and secondly um the existing portfolio also have child cycling costs so it's not like if I don't apply this method they suffer no transaction costs they do because these are actively traded portfolio even though it's an ETF is an actively managed ETF so they prune the position they add new stocks every month so there are transaction costs intrinsic to the portfolio all we do is to recommend that hey when you buy this stock buy more or when you when you buy the other stock buy less so the transaction costs that we incur are kind of part of what they would normally incur anyway it's not in addition to what they incur that's why we don't uh you know consider a transaction costs in this kind of optimization so you you the weights of the CPO don't move extremely dramatically from I guess an equal weight is probably the least the one that's going to move around the least but it does require rebalancing when one stock goes up it needs to be sold and and vice versa yeah and you know uh I guess the volatility of your weights is not out of control like from one month to the other it's not completely different is it that's right for this particular photo equal weights actually doesn't mean that you hold the same set of stock with the same Capital month after month because like I said this isn't actively managed portfolio so every month theoretically they could get rid of half the portfolio and find another half of the portfolio completely new stocks when I say in vehicle weight it just means that in the beginning of that month all these new stocks positions have equal weight it does not mean that the same stock positions are held month after month uh and rebalance through the equal weight until the end of time right so there is already a lot a major amount of transaction costs every month that is embedded in forming this portfolio we did not actually add further to that transaction we only asked them hey instead of equal weight buy more of this or less of that yeah okay um okay so um just to illustrate that this method also work uh on the portfolio strata training strategies instead of just stocks we have a client that is called as wsg Market is a Forex hedge fund they manage seven trading strategies in that portfolio so the constraint of our modernization is that each strategy way can be between 0 to 40 percent we cannot short a strategy in other words and again we improve the sub ratio in an out of sample test but most importantly um we actually deploy this optimization technique live on their portfolio starting July 2022 and so far uh the report that we received said that we have added about 60 basis point a month to their portfolio compared to their existing allocation method um finally I want I want to talk about a particular portfolio given to us by his private client is this portfolio is a stock portfolio I would call that a tax stock portfolio because these are all tech stocks and these constraints zero percent to 25 on each stock but there's one flexibility that we have and that is we can allocate up to 50 of that portfolio in cash and because of that flexibility we are able to generate positive return over the same amount of sample period as the mesh ETF which is a surprise because this is Tech stock it's supposed to crash very badly in 2022 but fortunately our method was allocating 50 percent of the problem to cash during that period And it rescued the portfolio from a negative return over this one year um our simultaneous so um I've got another question and um so the question is basically people are curious about the details uh you know so they're asking how are we modeling the market regimes for example what prediction variable is used what type of machine learning algorithm do we use so I mean I guess it's it's a question about like reproducibility like how is it in your paper uh you know do we do you talk specifically about where's the magic sauce is it in the choice of the of the variables is it in the in the you know the the machine learning algorithm that's used um you know I suppose that uh that we're curious here about reproducibility and like what are the parts that I think you I guess that you you can easily uh just give away and what parts are you know I I guess after all these are all successes you've had with clients so there's maybe some proprietary information so I guess we're kind of curious where where what are the things you you want to give away and what are the things where where there's something proprietary yes so um certainly the input features are important and we actually have numerous blog posts uh describing what kind of features you use one of which as I explained earlier is what's called a net Delta of options um in the market you know are people aggressively buying core options uh to bet on end of the reversal of the market such as what happened with GameStop and so forth others are simply you know in high volatility or uh uh the returns of various uh futures um and you know there are numerous of them and you know we have described not the exact formula of how to compute them but give a very strong flavor of what they are so they are not no secret but of course to engineering them correctly requires some you know care which is is the concept it's not so so so out outlandish or Innovative but you know it's just required for a lot of engineering detail to create those features and we have disclosed a high level description of them on our many blog posts on our website um in terms of the machine learning outcome that's the least proprietary I can tell you that we use gradient process decision tree and a fourth of them and that's that that's that doesn't mean that neural network or deep learning does work no we just haven't got around to try them so if you you can perhaps you know outperform our method if you're using more advanced machine learning technique but we thought that the key of this method is not so much the machine learning algorithm but the different pieces that are put together um in terms of Market regime as I said we didn't actually um in my first apology to the uh more quantitative practitioner here we actually don't Define the regime we don't even know that there are discrete number of regimes the regime prediction is implicit that is to say we are using these hundreds of features to represent the state of the market the the regime if you like but instead of giving a name to it we just say oh hey currently the market regime is the fix at 16 the oil price at whatever 50. a dollar per barrel the um interest rate is at 4.75 and so on and so forth so we don't have a name for that regime we Define that regime by giving you 180 numbers and here take it this is our current version so there's no prediction we're just there's no motor it's just plain vanilla 180 features that's the regime um and in an exact way you you function that takes x uh X's that are control variable X's that are Market environments and then you construct a y which is a response maybe a sharp ratio and then and then you fit this function f over many scenarios of the control variable for each given Market state and then once this function is defined I guess it's a tree or whatever it is the machine learning technique is then you input your your state of the market and that and how but then your question your output should be your control variable right or it's your no um yes so the the label of the supervised learning algorithm is what you want to maximize let's say sharp ratio yeah 30-day forward shop ratio and then you know and and since you have many proposal portfolio right you you can have 100 million proposal portfolio everyone you feed it into this uh predictive formula and you get a sharp ratio and you say oh well I like the best sub ratio of course and so you say Okay proposal 157 has the highest drop ratio I like that proposal portfolio and look at that proposals portfolio oh it says allocating five percent to Google ten percent of Microsoft and so forth and that's that's the resulting that's the answer you're looking for five percent Google and ten percent Microsoft and so forth right okay yeah um and um so the so the only secret sauce I might say that we don't disclose is as I said you know you might have a hundred million proposal portfolios in fact you could have infinite number I mean let's say you have a 500 stock portfolio and you allow cash it is a 500 dimensional space that you have to search in um and you know you can put a grid on this 500 dimensional space uh to and try them all you know try every proposal portfolio in this 500 dimensional space obviously who be very difficult it would be impossible so one of the the algorithms that we develop is where in this High dimensional space do we search that is actually the the key to solving this problem which we this that's the secret sauce so everything else is quite plain uh as I explained you know that's that it has antecedents in the in the uh literature right okay um so we have another question about uh that asks how big of a portfolio Universe asset Universe have you used or what what is the biggest that's feasible well the biggest we have um uh twice over is a toy strategy which is the first one it's the s p 500. now but I should say that the complexity of the problem does not scale linearly with the number of assets and that is why I said the secret Source right if it if we don't have that particular trick of sampling this High dimensional space it would grow much you know exponentially with the number of assets essentially your every extra asset add a new dimension to this space right so instead of 500 Dimension if you have 101 stocks you're going to have 501 Dimension space so you grow exponentially the number of um uh samples but the pop but in our method it actually doesn't grow like that it goes um something like the um the square root of of the number of assets so it's quite uh manageable another thing that has been growing exponentially is the number of questions in her q a so yeah I'll take a a little break from asking you questions and let you finish your talk and then we'll see uh how many we have time for okay sounds good it's not good yeah um actually I'm uh about to oh yeah let me wrap up this particular use case because it's interesting um well I mean first of all the comparative Equity curve everybody like to look at that and of course I wouldn't be displaying this curve if CPO doesn't have the the best you know performance overall in the equity curve but the Knicks Equity curve that is the next highest performing is embarrassingly the equal weight allocation so many decades of financial research come up with some of this worst Equity possible that nickel weight is almost as good as CBO so but the next graph is actually what I'm trying to thrive at is the cash allocation so many um people that we we pitch this technique to ask you keep saying that this respond to regime how do you show us that is this portfolio allocation actually respond to regime correctly and here is a good example if we just look at the cash allocation you can see that you know if you if you imagine that it's a two-state cash allocation either zero or 50 well in that case the pink shaded area where the cash allocation is at 50 percent and if you superimpose that on the S P R 500 Index you see that almost every time there's a big dip in the index we are uh in the 50 cash and now of course there's a caveat um and up to this point this is all training data up to 2021 July these are training data so you say of course you overfit it to the past but the gratifying thing is that in the out of sample data when the bear Market started in 2022 we are also most of the time in cash and that was what saved the portfolio from a negative return overall so um there's some Pairs and whistle namely that you can set your objective function to anything it doesn't have to be sharp ratio uh unlike the um traditional portfolio optimization method where basically the objective function has to be either maximum sharp Ratio or maximum return or minimum uh variance because of the you know they all it has to be any point on the division Frontier that was the tradition classical invent technique where because of the non-linear nature of our learning algorithm and our optimization algorithm it can be anything it can be any non-linear function of the portfolio can be used as a objective function expected short for is a popular choice among some of our prospective clients um constraints can be applied as I said you know certainly weight constraint but as well as anything that you can you know that that is fashion mode today Ms ESG waiting uh or or or or um turnover is another popular constraint uh you know some of you have concerned about transaction costs and indeed one of um you know we have a proof of concept going on with msci and indeed turnover uh is one of their constraints uh important constraints so um so many of these uh features that we provided as I said a Time series feature measure various aspect of Market but we do have a bias towards the U.S market features right so um there we have some European guys say hey how does your feature going to work on European market how does your future going to work on Japanese Market on Chinese market well the good thing is that our system can accommodate any features that the client can provide so that's not a constraint um you can merge with us without telling us what they are so that's one of the um um sort of this software uh flexibility and all that is provided as an API but that's just sort of the implementation aspect so I would you know I would stop now since we only have five minutes and you know maybe take care of any other questions that arise yeah sure would you rather me read them to you and to make it a little bit more uh interactive or easy yeah please please um all right so um one the first one I have here is in your first example you mentioned allocating to stocks trading at least one million in the S P 500 using 10-year training with Windows how do you deal with stocks only recently added to the index um or stocks whose nature changed over the 10 years say due to spin-off of key operations that seems to create non-stationarity and very short history of data for such stocks well you know uh in in any portfolio um there uh we allow for addition and deletion of component right so every time there's a new portfolio uh you know we we would uh essentially train them the model um from scratch right so so every time there's a rebalance of the full components we we have to train a new machine learning model and in that case it is not a problem if some of the component stock has short history because when you consider this portfolio history you know a one of the components that has short history simply means that um the return of the portfolio prior to the existence of that stock uh does not include that component right you can still compute the portfolio return it's just like the S P 500 Index you can compute the S P 500 Index return even though the component always changes just like spy the the spider ETF you know anyone can compute the spider ETF return since I don't know 1970s even though many of the stock cease to exist or many of the stock were recent addition to the index because at the portfolio level the return can be computed just by assigning Co weight to those stocks that didn't exist prior to a certain date it was not a problem and the key benefit of this particular technique as opposed to the microwaves technique is that in markovitz you will have a hard time doing that because you will um you know some of this stock will have less as you said you know maybe a few days of returns how do you compute the expected return if you only have a few days of assistance but for us we don't care about return we don't care about any cross-selling features what we care is the time serious features we don't use stock returned component as input to the algorithm at all so this is actually much less of a problem to our method as opposed to the markets method okay um so the next question is um so the regime changing is described by the weighting of the factors if regimes changes uh the weightings of the factors also change significantly in this sense yeah you can say that um yes I mean the factors for example if you consider um the um HTML family HTML Factor as an input right so regime change would mean that the xmi factor goes from positive to negative people suddenly laugh close stop the next ml Factor will become negative so that would be one example of a regime change but as I said our regime is not defined by one variable but it's defined by 180 variables so I give you the entire 180 factor to you to say hey he's the regime you know it's not just the fact that value goes to growth or small cap become out of favor and large cap becoming in favor it is the totality of the measurements but thinking about you know a single factor or three factors kind of helps simplify it so if we're thinking of this um you know Fama French model are you thinking of your three factors being the re the three returns over the last 24 hours and then based on these three returns you would um you would maximize the sharp ratio over you know over the next week or month or it seems like you know the these daily returns of uh High minus low and so on they fluctuate all over the place right or right right you know maybe Fama and French did monthly returns I think so last month's growth High minus low would be your main input to decide what your weights in you know all 500 stocks let's say of the as S P 500 are yes so um now that's a good point um you know a lot of these um features are simply measurements at different time frames so as you pointed out for example HTML Factor you can measure it daily you can measure it monthly you can measure it quarterly and hey why not put all three it's three different features we have no idea which one is important to define the regime is the market looking at one day or is it Market looking at one month we don't know forward all in Let The Machine learning algorithm decide so all these factors are um flowing into a machine learning from you can apply feature selection and so forth to eliminate those that have no significance in predicting the outcome of this portfolio and so you only have a the top ranked features that are actually useful in predicting the future of this portfolio all right and next question is uh is this problem formulation a type of cost sensitive classification I'm not sure I understand it yeah neither do I yeah I actually I don't know what concepts cost sensitive because it's not quite a classification problem yeah although I guess you can reframe it that way because as I said what's important is ranking it's not really regression but it's ranking so as I will reference this popular paper that talk about ranking in portfolio construction you can in principle use a classification model um to say you know which portfolio has a higher rank so yes this can be reframed as a classification problem um if that's what you mean but I don't know what a cost sensitive classification is the next question is relevant to this ranking they ask do you pick just one optimal portfolio or can you use an average Over N best portfolios in a Ensemble yeah no that's a great question I'm going to tell my researcher to look into that because um yeah currently we only pick one but yes in principle you know why only use one right I mean you know certainly an ensemble seem to give a more stable um selection but thank you for that question yeah we we pride ourselves on having a smart audience all right so the next one um for training if you have one million combinations of portfolios are you training the model on one million combinations on each day of historical data in printful yes yes um uh that's right yes you you have to have um yes every day you would have 1 million rows of training data if you are actually you know you have one million different combinations yes you are exactly right fortunately because of our secret sauce we don't have to do that otherwise it will be required a lot of computational power yeah okay and well uh let's ah I was gonna there's one more question that popped up if a regime is a vector of 180 variables and another regime is another such Vector then what metric do you use to quantify the distance between regimes can you tell the regime has changed or not well like I said we don't um this is not a two-step problem I know that the moment I mentioned regime there will be this confusion maybe in the future version of this talk I'm not going to spend too much time on regime because the the idea is that we directly use this visual factor to predict the performance of a portfolio we don't use that to predict a regime and then condition on that particular Gene what is the probability distribution of the portfolio outcome it's not a two-step process unlike perhaps a hidden Markov model or one of those latent variable models so um I I think you know in a future version of this time I'm going to skip that completely perhaps because this that does cause confusion this we don't actually identify the regime first and then condition on that regime what's the distribution of returns or sharp ratio is okay but maybe that question still like let's say that you know in 1973 uh the exact same 100 variables or they were extremely close to what they are today and you've you've calibrated this uh you know this machine learning algorithm you would expect that expect that because your current regime is close to January 3rd 1973 that somehow are the weight would be the same right or or that's right that's right but we we don't necessarily know the rate the same it depends on how other portfolio Capital allocation um uh uh performed in the expected reform but certainly the expected return would be similar to what happened in 1973 if we had included a lot of that training sample in 1973 yeah well the last question I'm gonna sort of join it and they just want to say great presentation and thanks for for a really interesting talk thank you thank you glad to be here yeah thank you very much 