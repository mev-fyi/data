[Music] tons of attention back um you guys are going to have to implement the mic sharing protocol i'll let you debate on on how you want to do that um well while everyone gets set up yeah please take a seat there's a few seats here in the front so if you're sitting at the back and you're tentatively considering sitting down for the talk please come forward uh no one's gonna be offended that you walk around during the uh the panel so um we're gonna talk about wallets daps and and general mitigation so i'm gonna start by doing a quick introduction about myself and and frame the discussion for the panel so i'm stefan at the go step i'm a founder a steward at flashbots and i work on a lot of the architecture i spent a lot of my time before joining flashbacks thinking about how to improve the ux of ethereum how to improve the applications i built on top of it and that's one of the the parts of mev that i find closest to my heart which is how do we make sure that the user outcomes that the protocols that we build take into consideration mev and allow us to create systems that benefit these end users what are the creative things that we can start to build if we have an mev aware system so i'll go through quickly and maybe you can say uh you know your name which project you're from and then we'll get into how how how that will release them ev after afterwards cool yeah hi i'm felix i'm the technical lead on cow protocol and should i introduce the protocol or do we do that later okay hey uh i'm sam i'm with uh maker dao i work on the protocol engineering team hey i'm skeletor i'm from the urn finance team and i work on mev protection and on-chain automation hi i'm simon i work for consensus as a blockchain ecosystem advisor hi guys i'm alex founder of block wallet okay great so we have representation from wallet we have representation from uh from protocols and we have some middleware i don't know if you would brand yourself as a middleware as an aggregator but that's that's meb focus as well as consensus that of course has all kinds of different projects in the space i think one of the places that i want to start is with the protocol developers i think for a long time there wasn't activity on ethereum and that was kind of the glory days of mev because you could kind of pretend that it didn't exist but as soon as the activity started arriving all of a sudden it elucidated a lot of the challenges that mev com brings to protocol design um so maybe with with maker dow first can you talk to me a bit about um you know how maker dell's journey through understanding mev has been and which part of the protocol design that you guys think about it uh yeah sure so um back in the day the glory days as you say of not having to worry about mev uh maker used to run uh an english auction system where we uh people would have to have uh capital on hand to bid on the auctions there was basically no defy at that point um just just basically make a dao uh unit swap compound and you know some other stuff but the ecosystem was really early um but i mean our view on mev is it's a really useful tool for us uh to basically uh well let me start with the auction switch i guess so uh part way through we uh upgraded to a new auction system we're using a reverse dutch auction now so we can settle the whole thing immediately as opposed to having this capital lock-up requirement with the previous one so this is really uh useful and especially with the advent of flash loans we can basically democratize sort of access to these uh liquidation events um so that was a really good step forward so yeah mev is the tool there that sort of uh really helps us to uh not have to worry about you know having collat keepers with lots of capital and stuff like that i have a question for you um i don't remember what the name is was it black thursday or something like this that happened with with maker dao do you want to maybe explain what happened there and and how that relates to mev yeah so black thursday i think everybody remembers that fun times i remember the call actually uh when that came up i think we had a max capacity governance and risk call that time and i think everybody in the ecosystem was uh watching and hoping we could get through it so basically what happened was uh eth dropped i think about 50 in value in one day and uh during the cascade of liquidations this was under the old system there was an exploit where somebody could basically mass bid zero bid on uh all the collateral um and so the idea was that the chain was so congested and people were not ready for this that they were able to succeed in uh stealing uh well i don't know if you want to call it stealing they uh took uh about yeah for they took for free like about uh i think it was about five to ten million dollars which was a lot at the time so we had to debate uh basically whether we were going to actually i wasn't working at maker at that time so just watching as a community member but they were debating whether to have to trigger global shutdown at that point because the protocol was in a danger zone but we squeaked through we took the loss the community rallied together and actually purchased the uh newly minted mkr to cover the the loss and i we survived and i think we're stronger now for it to me this was such a fascinating story and and flashbacks was founded a few months after uh after this event took place because we realized that you know there was a lot of education to be put into the space around around mev and and i think iterating the auction design in such a way that allows for liquidations to happen more efficiently is a key way that that apps have to think about mitigations within the design of their system um maybe with yearn can you talk a bit about uh the mev journey there and and how you consider that in your program yeah absolutely so up to to your point we we do also have uh like systems in place let's say to take care of our cdp maker for our uh strategies for example and we also like in the golden days where there was no mbv the chain was always working perfectly there was no clogging et cetera et cetera we only had like cryptokitties that one time really long time ago and now everything was fine we never ever thought that we were going to need a system where we could like push transactions through and we would know uh at which block and with which parameters they will get into uh which on these uh more risky strategies it's a must uh to be able to tend the strategy properly and not uh like push losses back to the users uh besides that um basically with how strategies work in year is basically if you farm some random token then you dump that token uh to your underlying token uh and that specific interaction can be done either manually or through automation through keeper network uh both of those back at the time were extremely vulnerable to mvv basically they had a hundred percent sleeper extra level so you can basically sandwich the entire rewards uh of a harvest or of a profit uh transaction um we obviously saw that and we say okay somebody at some point will exploit this and since we were extremely extremely swamped with work we say okay when at least we have one uh people that is going to be exploiting our strategies we'll start working on it we have that event uh rather sooner than later uh way prior previously to flashbots etc and we decided to obviously first step move back everything to be done by hand uh close up all the automation and then put up a lot of contracts in place to be able to force keepers to go in through like a stealth transaction relayer which forces them to use a private net pool um that let's say if they're if their transaction becomes publicly available we can slash that transaction and they will lose like a certain amount of ether which should be kind of their reward for the searcher or the person like looking out for uh our like harvest or something like that um do you want to talk a bit about the the tools that you explored in and and how you went about implementing these tools into into yearn uh yeah so basically this uh stealth transaction type of contracts is something really generic anyone can uh grab it and put it out on their own it's completely generic we also have a ton of tools built around the gnosis safe to also protect transactions that might have or might be vulnerable to mev putting up agnosis card which was introduced in one of the latest versions we also do a lot of monitoring and we use generally for a lot of our sandwich alerting so we simulate whenever we have a transaction during harvest we simulate a transaction if it was the first one like index zero on the block and then on the real transaction and we see if any of the state changes and we have like a white list of state changes that we monitor to see if we got like properly sandwiched or not um so so you mentioned stealth transactions yeah uh tell me how that works how does the integration work there because i think this is going to be an interesting lead into into some of the discussions the other panelists i want to know from a debt perspective yes it's great to be able to send transactions directly to a minor to bypass the transaction pool tell me a bit about the integrations maybe what are the pain points of it yeah so basically uh we are protecting against two main attacks uh one of them is obviously your transaction being sandwiched so somebody gets that from the public mempo so for that we are rooting this or making the the sender root this transaction with a secret hash that they need to randomly generate if that hash becomes publicly available then anyone can report the hash and the transaction will not revert if the hash is reported but it will self slash itself sending a part of the reward to the one that reported the hash secondly we also uh prior to uh like after doing this we say okay yeah but we can also get uncle attacked and this is when ankle attacks started happening and says yeah this is obviously it was going to be a mistake so we added as well some block uh like block number protection so whenever you send a transaction you need to send the block number on which that transaction needs to be included and if not it will effectively revert you can have this on flashbots but even though flashwatch will add your transaction on a specific block that transaction can still be anchored replayed uh because the trans like the protection is not at the mev level uh so even if you have like let's say two blocks one is uh flashbacks block and the other one is not your transaction will be available on the ankle block and it can be stolen and replayed in a in that subsequent block with plus one height from your block so there is a ux uh it's basically an ux paying in the ass because you need to broadcast a ton of transactions one per block so what we do is basically we broadcast 10 transactions with the same nouns with different block numbers and let flashbots do they are lifting uh so thank you for that um uh and yeah it's not that you're we are dosing or anything those are like pretty tiny transactions etc uh but what we are most excited and worried about is uh reorg attacks and all of this kind of stuff that will would really break the system we do have some improvements in place which is we moved all the swapping mechanics out of the strategies and into a new system where we would do uh we would root most of the trades internally so we would do a lot of co-swaps etc which are less prominent to be attacked okay cool so i hope this gives sort of a taste of you know implementing mev mitigations in particular stealth transaction still requires a lot of developer effort and it's not a place today where it's super easy i think one of the interesting things in the last years um that i've seen is i thought you know flashbacks would launch a private transaction pool that users would be like finally you know i have a way to not get sandwich i have a way to protect my transactions and get get good inclusion turns out users like had no idea that they were getting sandwiched in the first place and it's really protocol developers who realize oh wow like there's this new tooling now that i can that i can integrate into my stack um i want to move to maybe a layer above the dap and and and and that will be the wallets and and aggregate aggregators as well um how did you guys let's start with uh with lock wallet how did you guys start encountering mev and how did you think you know this is something that we need to build features around sure so um a first disclaimer is that we're using flashbots as an option to users in our wallet to basically avoid sandwich attacks on unit swap and most popular dexes i think it all started from there um we we were developing and we had a community for the last year we launched our wallet 45 days ago but throughout the time when we were developing um i think the whole twitter space got exposed i think the the most uh prominent discussion about mev attacks and stuff is sandwich attacks right i think that's where the average defy user is aware that you know high slippage can cost to money um so we ended up uh to us it was a simple uh ux solution right offering uh users with extra extra value so yeah i think we're the first wallet to integrate flashbots as an option and yeah i think some of our users are are using it they they love it we love it too um so it's a great experience so far okay i think this is one thing that um i i didn't like think would take so long to implement it it seems like having more optionality for the user to decide on where they route their transactions makes obvious sense to me um but it's taking quite quite a while for for wallets to to integrate i'm gonna call out the consensus representative one of the longest standing issues on the metamask github is please allow the user to define a way to have their own rpc so to allow them to protect against um against front running um there's been a lot of back and forth and discussion obviously with the metamask team i'm wondering where where does consensus sort of see mev protection med mitigation right now you know why why is this sort of an issue that has taken a lot a long time for for for metamask to react to et cetera thanks uh so yeah i joined consensus about three months ago um and so my my job is really to kind of uh identify trends or potential blind spots that might affect teams that they need to consider and advise them on them so about two months ago i started looking at mev because it seemed like it would you know affect every team in consensus and it's taken a most of my time since then it's a really complex issue i'm still falling down the rabbit hole um and so the problem with consensus is the size of the company right and when you're that big you don't want to make any sudden moves because those seven moves can have displacement effects that could have unintended consequences so an example for that is like the question you brought up with regards to metamask so if metamask implemented sort of front-running protection that you know offered some sort of private uh channel directly to um you know blood producers then um so you know that would work that would work really well but then you're kind of opening up the vector for proprietary order flow and you know by itself doesn't really have any negative impacts but taken into consideration with everything else that consensus does including like infuria and staking and everything you could unintentionally create a centralizing force and so i think from consensus point of view where we don't want to make any sudden moves being conscious of our size we want to have a coordinated approach across all of the different teams unfortunately that's kind of a little bit complicated but it's something that we're trying to work on at the moment do you want to talk a bit about what are sort of the the key concerns you know that you've uh you've discovered while evaluating mev and maybe a framework by which you you you think about exploring solutions yeah so i mean the key concerns write it in order of concern is probably the effect on the users first and foremost right um and especially with metamask i think it's safe to say that a lot of new entrants into the space use metamask and it's their first experience of dealing with with uh like web 3 crypto um so we don't want a poor experience for them right from front running or sandwich attacks but beyond that as well is a huge concern is the centralizing force that muv can have right both in terms of centralization of black proposers and block builders as well and alex from flashbots did some great research in terms of an exploration of mev and eth2 which highlights the centralizing force of proposers and i think you know like me v boost and pbs goes a long way to mitigating that but it's still sort of a concern and then block builder centralization and and i don't think it's fully understood what the the implications for that are just yet so those are the things that that we're really looking at and like we're currently establishing a framework to to really understand like what those implications are who the actors are and like who we should be talking to um but yeah as i said mev is in and of itself very very complicated but when you couple that with an organization that has multiple different teams that work independently it gets even more complicated so yeah it's a tough cookie to crack it sure is yeah um and i mean one thing that is obvious is you know just like there's still huge pain points and integration some of these solutions there's also very few solutions out there so um there's so much room for for exploration and innovation to help mitigate those concerns and and improve upon them um i think to bring in kel swap um uh cal slope is partly a team that has been looking at nav protection for a long long time that's proven by the fact that you own the twitter handle mev protection so can you tell me a bit about you know the cow swab journey through through through mev where it became obvious that users cared about this um i think if i had to to frame the the discussion here or the or my perspective on cal swap is it's taken an approach of like not just okay we need to solve mev but rather how can mev fit into providing a holistically better experience for for for users um and i want to i want to i want to hear a bit about you from about this yeah for sure so counselor actually comes from a very long journey within gnosis the company that cow protocol spun out of and i think must have been back in 2017 when gnosis was considering implementing automated market makers for their prediction market outcome tokens basically as a market mechanism and they decided against that because they saw back then the intrinsic flaws of automated market makers when it comes to front running sandwiching all that stuff and of course that was turned out to be a big mistake they should have followed up with that but basically at that around the time when phil um published his first paper about mev we started thinking along the lines okay how can we build a mechanism where mev is actually reduced and one thing that i've seen also throughout the day today one of the themes in the space is more around the lines of how can we redistribute mev how can we maybe actually make it part of the security budget or kind of other attempts that's what i see the the the ecosystem focus a lot on i think what we have traditionally done um from gnosis and co protocols perspective is really thinking how can we reduce the amount of mev that is inherent to the protocol design and to the to the mechanism that we trade and one of the ideas there was that blockchain is already discrete in time and we already batch different transaction into a single block and then execute them all at once in a single you know atomic timestamp so why do we have a continuous time trading mechanism built on top of that discrete settlement layer whereas you know 2015 eric buddish and his colleagues um suggested to use frequent batch auctions where basically you collect multiple trades and settle them in one single transactions at a uniform clearing price kind of getting rid of that ordering problem that is kind of the source for meb and so i would say in 2018 we started our endeavor on the research how can we build frequent batch auctions on top of ethereum and uh what's called gnosis protocol at the time started to you know it was a completely closed system where batch options were implemented but we didn't really have any we couldn't tap into the atomic liquidity layer that was on chain and kind of the learnings that we got from there was people don't actually care so much about the mechanism that they're using so it's not really you can't just live by the idea that build a mega builder build a better mechanism and people will follow that doesn't really work and so we're to think about ways of how we can overcome first of all the chicken and egg problem of attracting users for that you need liquidity for liquidity you need users and also how can we make it so that people actually care and so the second version of the protocol then i would say on the technical side the revolution was that we went beyond those closed batch auctions and it will actually allow it to have a thin layer on top of existing amm liquidity where basically we can allow to match users in batches and peer-to-peer with one another but if there's just one person in the batch we just basically default back to being a meta dex aggregator and settle them with the best on-chain liquidity so we made it kind of a pareto improvement if you want for users to use our protocol and at the same time we combined it with a lot of like you know nice usability features we have this a lot of people really like the moo sound apparently that comes after you trade um you don't pay for gas and eat you pay for gas and your sell tokens so when you're just harvesting your your your yield coin that you just want to reinvest in the underlying you you can pay with that and so we really focus also on the on bringing making a product that is really appealing to users and not just relying on building a better mechanism and people will come and so i think yeah that's that's history yeah it's funny you know you think that you're going to build a product that's great because it protects the user from mvv and then it turns out that they love your product because it has a moo sound and you're like oh wow well you know all this engineering work was you know really unnecessary here um okay i want to i want to talk a bit about uh forward-facing things and and get you guys thinking a bit about the future um so i think one trend that i'm seeing coming down the line as we move to more a uh a multi-chain future is uh something that uh that i like to refer to as domain abstraction so it's the idea that um we as as adapt developers and as wallets want to abstract away from the user a lot of the decisions on what where the transactions end up on which domain they end up because ultimately that's not what they care about right they care they have some intent which is to do something else which is maybe to do a trade and collect some other token or buy some nft and they shouldn't have necessarily to to worry about um the intricacies of like what happens uh in the execution of of this trade i think we're probably headed towards a future in which there are more service providers that help figure out how to how to um how to um [Music] route these transactions and execute them in a way that hits multiple different domains my question to you guys is you know in a world where we want to abstract away a lot of this complexity from the users what are the missing pieces of the puzzle to be able to enable that kind of of user experience maybe you can start from from cloud protocol's perspective i think we're very much already steering towards that direction by this basically separating the actual trade that a user does versus the um the execution so basically on co protocol people just say i want to trade this asset for that asset at that limit price and you leave the trade execution up to a professional entity like in traditional finance that would be a matching engine and as a matter of fact we have multiple matching engines competing for the best execution and so in a multi-chain world you might okay say where is your token come from from which chain or whether you want your tokens to end up but you know if you're just on polygon or or gnosis chain or some other side chain and are trading a large amount where the liquidity is best on mainnet you don't want to bridge over and bridge back but by virtue of having kind of this decentralized solver network and co protocol you don't actually have to do that you can rely on an external market maker sweeping in that liquidity and executing it on your behalf and those market makers can do much more smarter things than you would they could bridge more than just the amount that's needed for your trade they could use some predictive measures to to to optimize the cost for you and so we think that we're positioned in a pretty good direction towards making this this effective by having um yeah a very competitive um yeah matching engine landscape oh yeah so uh with maker um we are currently full force focused on getting onto all these different chains uh we'll be uh we're already have our own bridges uh deployed on optimism arbitram and starknet and we're actively working to get the maker protocol on these chains uh we're big believers in the multi-chain future and in terms of like what's needed i think just a lot of it is just basic infrastructure we need like we need maker on these protocols we have various products we're working on to basically inject dye liquidity into all the places that users are using um so that that's a that's a big piece that we're kind of uh we're working towards right now are there any unique challenges that come from having maker on multiple domains maybe with regards to mev specifically that that you anticipate will will arise from from those deployments um yeah so makers a lot of other protocols they sort of work in isolation so they can just sort of take the code base redeployed on a remote chain it's different for us because every time we go to a remote chain we are incurring some risk to the core protocol and die so we need to be very careful and measured where we go and evaluating the security models of these chains you know they're not like they're working towards uh progressive decentralization all that stuff we're not quite there yet so uh setting appropriate debt ceilings um for the amount of diet that can be minted on these chains as they're in sort of beta phases um is very important that's a unique challenge for maker yeah yeah same plus one on the on the security and reviews and etc and also i'm setting up proper uh let's say safety nets for if she hits the fan basically i do still believe that we are pretty young in the multi-chain kind of golden days let's say when everything is uh quote-unquote safe um but yeah and yearn we are also building our vaults b3 which um has a lot of functionality to be able to have users put money into magnet or whatever chain and us be able to route into strategies that might not be in the same chain possibly um we also we were just uh talking at lunch about um a way to to let users either withdraw or deposit uh be a signature via whatever chain they want um that's also pretty uh pretty nice and as i said before we since we don't have that much mvp risk right now on how we build things or how the changes on the design we made we do not incur in any additional risk on the mbv side on going into these chains we do have a lot of security risk and we do would put a lot of effort in analyzing on and doing like uh actual safe yield farming uh so yeah i think that that's still uh there is some improvements uh either for us at least if you don't have anything to say you don't need to say anything um you know so like i think you know consensus really believes in a um like a multi-chain future i think that that's safe to say it's inevitable um but you know it's interesting one of the last panels kind of said as a searcher that like the the change that they prefer the most are the the least centralized and that was kind of an interesting remark you know personally speaking in my role something a real challenge i'm finding is is how do you measure decentralization on different chains and that's something i think really needs a lot more research right because people talk about decentralization but when you really look at it when you really look at client diversity um geographical dispersal of nodes the amount of different developers the activity of developers and all of the various things that go into making a network really safe um things aren't as decentralized as people talk about right and i think you know that's really important for um for application developers and infrastructure providers to to think about and to try to get more data to so so it's really transparent which networks are actually properly decentralized and which which aren't maybe a good question how are you doing on time is there a time keeper time's up okay all right well thank you everyone for for coming in tuning in for this for this wallet and apps uh um panel i hope it was insightful and how how various teams are approaching this obviously go come talk to them if you're you're looking at solving similar problems or looking at integrations thank you to our amazing panelists [Applause] [Music] 