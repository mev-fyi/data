cycling like last talk of day um presenting this will be tomas and alex tomas is from another mind analysis from flashpots and they'll be talking about what the world looks like um with that maybe after the merge happens and uh we'll represent any other mindset flashpot so welcome to mouse and alex thank you karte hello hey thank you for having us excited to have you all remember works as tested [Music] maybe while tomas is uploading the slides it would be awesome to kind of get an introduction from uh from you each and uh and maybe then jump into the talk sure i'll i'll start what what tomas is sharing uh some alex from flashballs uh have been looking into um flashballs um after the merge and mev after the merge so flashbacks we focus on mev the negative x natalies that come from the current extraction techniques related to it uh and generally the the way mev is shaping um this technology um yeah i guess we'll we'll share more in the presentation tomas all right hi yeah i've been working on the nethermind uh jerome client for the last few years and yeah today we're gonna present a mov after the merge with the mountain flashboards uh so welcome everyone hi and what we'll talk about so first of all talk about the merge itself so the minimal spec for combining ethereum one and ethereum two nodes uh then we'll talk about the ryan is which is this uh event within the event uh it's all the if one if two core devs getting together to prepare the devnet of the merge um then we'll talk about uh introduction to mev um to minor extractable value and we'll show how flash bots enable and move in ethereum now then we'll ask a question whether mmv is possible after the merge and then there'll be lots of numbers alpha leaks so make sure that you stay till the end so maybe what is ryan easements uh and why we've been involved in all of this so uh between april 16 and may 14th as part of the global scaling hackathon we see the ethereum one in tier and two core developers building together to deliver the minimum specification of something that in the future will be simply called ethereum and ethereum 1 will be the execution engine there and ethereum 2 as it is now will be consensus layer node and what you see here on the screen is the example of the taku and nethermind working together as part of the first work that was done on the first minimal spec so the merge and delivers something most basic so it delivers the clients that operate isolated and only connected through a simple rpc interface and so far we already see implementations of that spec in ethereum to clients in lighthouse and in tecu and soon we should see the other clients following and for the ethereum one execution engine that's for the catalyst which is gaf for for the merge and nethermind and again the other clients should follow us promptly so both of the clients here operate with their own peer-to-peer networks so there is no interaction of the networks themselves so they discover their peers they do all the gossiping however some of those operations on ethereum onenote are disabled so ethereum one node doesn't gossip anymore any blocks but it does listen to transactions and it will do some synchronizations and all the block block gossipping is moved to ethereum two clients and the spec the minimum spec of this json or pc uh consists of four methods really the requirements to assemble block uh and that comes from the become chain to from the validator to the ethereum one node uh so the request comes from ethereum two as it is now but the actual block construction is on ethereum one and it's super important for mev as we'll see in a moment um the new block is more like information from the beacon chain network that the new block was created so the ethereum onenote can prepare the state for the construction for the block proposals set head defines what the bitcoin chain defines decided that the current head of the chain is and finalize block allows to do some cleaning and pruning when the block becomes finalized on ethereum 2 on the consensus layer so that helps it in one node to keep keep everything clean and as you see it's a 0.1.2 spec version very early version and we can expect lots of changes the the mind implementation is available it was a reasonably big effort but at the same time not so big that that it would be a massive massive thing to deliver uh and it's a good start and all the teams are now focused on this so this is already merged in nethermind on the main branch and you can test all of these by going to proto lambda's merge net tutorial repository and you can launch your own uh local devnet setup for the ethereum two and ethereum one clients working together uh so you can pick gaff catalyst or another mind and you can pick also i think lighthouse or taco here and something really fresh from today from the last talker devs meeting we see that this timeline for the merchant for 40 network upgrades on ethereum one this this runs in parallel so we'll see the london happening in july then shanghai which will be a set of uh of additional eips happening in october 2021 and cancun following summer later probably 2022 and in parallel the merge happens so that work that already started uh should be coming in october so it's pretty soon you can expect the proof-of-stake transition potentially even october this year let's move to to the mev explanations i think alex will uh take over from here yes thank you so much um so um because we're this this talks about you know mev and eth2 and at least the mvv after the merge it's important to maybe first understand maybe um it's definitely something that has been more prominent in the public debate uh in the last few months and it's something that flashbacks that we've tried to educate the community on or at least share more resources about so i mean at a higher level i've put a definition here which is that mev is a measure representing the total value that can be extracted permissionlessly from the reordering inclusion or censoring of transactions so the little image that you have under is you know on ethereum you have different transaction senders they submit their transactions and before transactions are included in the block they're part of the mempool uh miners pick transactions from the mempool and order them in a block um and they have full control over that ordering so they usually do that ordering by gas price but um in reality they might be more optimal ordering for them to extract more value out of this set of transactions or to insert their own transactions or sensor transactions basically to have they have full control over uh the content of this block in terms of the ordering of transactions so that's why the term minor extract about a minor extractable value was first coined by phil dynan is in his paper flash voice 2.0 was to represent this upper bound on the maximum value that can be extracted by the entity that has the most permissionless power over the ordering of a block um next next slide please uh and so phil um in a later presentation phil philbin again uh set out a a a simple parametric definition of of mev that can give you even a better idea of why you can think of it as an upper bound um and so as is written here muv is uh for a minor is how much if a special minor account can extract given a set of user transactions t in a mempool initial state s and a set of contracts c that the transaction the state will interact with and the constraints on that is by inserting their own transactions so inserting their introduction in the set s censoring any element in the set t sorry censoring any element of t or reordering t in any way that optimizes their ether count balance so that's that's the idea for the upper bound route but in in reality uh this is the the mev there's an mvp that's extracted there on on ethereum already um and it is not extracted by this this entity that has the most powerful transaction ordering so the miners um can you click actually again yeah there you go uh and so we've tried to try to quantify this at flashbots and we've released uh some of our work on this and there are other teams that have done so as well uh imperial and university example and other groups um but so what is essentially happening is today it isn't miners that are extracting value themselves but it is users that are expecting expressing preference on the ordering of their transactions and are sharing some of the value that they reap from having that preference met with the miners in the form of transaction fees so again as i mentioned we've tried to quantify this to give some some number for this and we've put a lot of our results in a live dashboard muv explorer that quantifies uh what this amount represents uh not only in dollar terms but also in these terms and kind of breaks that down and breaks that activity down further um so i realized this is all uh still a bit conceptual right so i i put an example here uh a transaction that uh where where there's there's mev and i i think i really want to nail this concept of transaction ordering so for example this transaction is an is an arbitrage transaction between different liquidity pools so you can see balancers and sushi swap going between between each pools and you can see the the sender started with 16 eve and ended with 32 if uh making you know there's 16 eth in that process but you can also see the transaction fee in there of 12 if and so to have the the to have their transaction included they paid an extremely high transaction fee much higher than the average uh transaction fee at the time or an implied gas price of 51 000 grey and you know we expect that they did so because they engaged in a priority gas auction another term that was introduced in phil dyn's paper where they uh they iteratively bid out their gas price against other competitors that also wanted to seize the same transaction and so we have an example in the same block and so in the next slide of uh someone who seemingly went for the same opportunity but didn't manage to seize it and you can see they still paid 1.1 ether in transaction fee and still paid 20 27 foul in gway so still twice as less as the winner but still um extremely much higher than the average gas price at the time which was which was 94 way and so this shows that the power of transaction ordering right because you're going to have a single winner that's going to win the opportunity and then every people going for the same opportunity that are not going to be able to to seize it and this opportunity itself has value associated to it and ultimately a miner given that they have the most power related to transaction ordering could put themselves uh in front of all these transactions and so this is why this is a subset or included in in the broader set of extractable value from an entity that has the most permission of power over transaction ordering this is what we're working on at flash bots in the sense where as you can see this like extremely high gas prices actually influence the whole ethereum network because it pushes gas prices up for everyone else and that's that's problematic and generally we are working on reducing the extraction costs um and this takes many dimensions which you know is beyond the scope of this talk uh but kind of gives you an intuition for what mev is and um tommaso is now going to talk about what what flashbacks is and also how mev might work uh in in after the merge so if you if you think how it was before miners could potentially extract the mev by themselves or maybe through some private arrangements what what flashbacks delivers is a more democratized way of doing it more decentralized way of doing it so everybody can become a searcher and you have assumption that there's lots lots of searchers looking for those arbitrage opportunities uh you can call them arbitrage or squeadators or depending on the strategies that they follow they may follow all of those depending on the circumstances and flashbacks deliver an mev relay which is sitting there between the searchers and the mining pools and provides the searchers with the direct lines to uh practically at the moment 58 of the hash rate that is available on ethereum so you really have a way of ensuring that you can sense the set of transactions and they will be included very soon in one of the blocks like there is a big chance that these mining pools were included and just one moment okay so what are the types of bundles that the searchers discover and send so they may find those strategies to some kind of liquidations or sandwiching or white hats transactions that can be delivered directly to the miners or toast transactions all of them always include the payment to the miner now that payment to the miner does not necessarily go through the transaction fees but by discovering the coinbase um coinbase value you know the address of the miner that you're paying to so you can make a payment through the smart contract or directly by including the transaction to that miner and uh all of those are used by the miners to assign scores to various bundles and pick the one that is providing the miner the biggest profit so it creates this separate fast line for execution uh in front of all the other transactions from the mempool and uh causes all those uh all the searchers to only compete for the uh tp to the miner between themselves and not causing the entire network to compete with them and potentially it has this uh opportunity of decreasing the the guest prices for the entire network and all the blocks that will be created by flashbots participating mining pools will have those bundles in front in front of all the vanilla transactions from the mempo and might be zero one or a bit more bundles if the bundle merging is included and so the big question appears whether it's still possible in serum two after the merge so what changes really based on what we described in this the merge minimum spec and um and how we plan that the term to do one will go forward so if you think about the current flow where you have a searcher sending bundles to relay and the relay sending that to the miners or mining pools and then those blocks being published on the chain so publish to the network and then include it on the chain if they win the proof of work so what happens now is we practically keep ethereum one nodes being responsible for transaction sequencing and they can still expose those endpoints to allow searchers to contact them and suggest reordering transactions deliver the private bundles it's just that the searchers are still sending that to relay and then it's the validator that receives the information about the bundles and the validator connects with the ethereum onenote and when asking for this for this block assembly it can ask it to create that block with specific bundles included right so that bundle delivery between validator and stream onenote happens and then again the beacon chain is used for block proposals and authentication so that block is being propagated with the meb included so this really still exists in ethereum two and when you think about this value that exists at the moment on ethereum one we see that on average for the blocks that include me include mev bundles the miners will make additional 0.18 if for every block which includes the bundle and those numbers may change because it's still based mostly on the on the early versions of the flashbots so we can expect that this number will be much bigger even like anecdotally twice as big and now i think alex will continue with like more numbers and how these numbers actually operate within the context of interim term thank you thomas um indeed so um why we've chosen that train of thought in our presentation is because ultimately the interesting bit is should mev exist in e2 as it exists in each one um how will that impact the yields that validators hope to make because they are the ultimate block proposes in in after the emerge as tomas is mentioned and this is something that um people have been wondering about recently as you can see on on the right like uh cyrus was talking about something that's very similar in point three and on the left justin was thinking about the impact on biodata yields not from muv specifically but for from from transaction fees who which we expect validators to make on top of the protocol mandated yields for good behavior and so these are these are important questions and so we thought let's let's run the numbers um yes i ran into numbers and um as tomas mentioned earlier we have numbers on mev not only from our quantification that i mentioned earlier the dashboard mev explorer but also from flash bots from the activity on flash box itself and because we have significant amount of the ethereum network running flash bots and also significant amount of traders or searchers on the other side submitting transactions to flash bolts and actual value going through we can use this as a proxy or low bound for the value that evaluators can make from mev at least from from running um mv enabled client like like flash bots mvvgef and so the core assumptions we're making in the numbers is as thomas mentioned 0.80 per flashball's block as well as the probability of blocks that are flashballs blocks uh which is 52 from our from our data again um and these numbers i mean we're kind of going through this model using pintel's amazing article on uh beacon chain validator rewards and the modeling that uh they have done there and uh the python code that they shared so we've modified their python code to actually reason about um mev enabled validator rewards versus the non-mev awards and there's some limitations to our approach that are mentioned here um first we're not accounting for transaction fees like was mentioned is in justin's uh tweet before flashball's data however uh you know um the the the activity that's on flashbacks is still a few months old and we expect as adoption grows and also as as people become more sophisticated this number will change and ultimately what tomas mentioned some of the current infrastructure limits the amount of heat per flashballs block and this is said to change very shortly and so again i take these numbers with a grain of salt and it's more to get an intuition for this and also thanks to the people that have contributed to running these numbers so terush rumor lapali and also terence and uh rule from prismatic labs all right so now getting in the numbers um we first started with the ideal case and the ideal case here is a case where all validators behave perfectly on on um on on e3 or after the merge by by this we mean there's there's 100 uptime and 100 participation and this is also the ideal case because we look at a long enough time range where we don't have to necessarily think between the the beacon block proposal reward and the general validator reward and we can mix both together because um on a long enough time range a validator uh can expect to each validator can expect as many blocks on average right and so as you can see on this graph the blue line is the ideal validator yield reward without mev and this reward decreases with number of validators of course and then the orange line is uh the same reward with mev and the the blue dotted line that you see is the the current number of validators we have which is about 120 000 uh validators for an equivalent of about four full million if uh staked and so at the current amount as is written below the current amount of validators 120 000 um mev boosts validator yields by uh 17.9 and so that's a that's an implied apr of 14.5 instead of 8.49 so that's really significant um especially given that when we compare the impact of mev on minor revenue in the current system the eth1 system with flashballs we're looking at something of a five to seven percent increase in revenue whereas here we're talking about something a lot more meaningful and that that has implications not only uh implications that are mentioned by by justin in terms of the security of ethereum but other implications that we'll mention briefly after another another case that we looked at again this is all following pintel's approach is a perfect validator on an imperfect network so in that case we're looking at a validator who behaves perfectly but then the the other validators in the network might not behave perfectly and this is this is modeled by the the participation rate of the overall network so that's the the p that you see here and the way um rewards and penalties are set up on on eth2 or sorry after the merge is that even if you as a validator behave perfectly you are influenced by the behavior of other validators and so pintel computed uh by how much your rewards fall if you're a perfect validator an imperfect network and you can see these these numbers on the left um and then if you uh look at these numbers now with muv you can see these numbers falling as well and so the the the kind of takeaway from this is with mev a validator yield falls less quickly uh than without it given different levels of participation for the networking given again perfect validator um again another interesting takeaway from it uh and the the last uh kind of case that we modeled again based on pintails uh own modeling um is an imperfect value they aren't perfect network so we're kind of switching things around in that case the validator is not doing the most amazing job but the whole network is um and this is this is model between these two graphs and so on the left you have pintails and so what pintel found is that for a validator to receive a net positive reward the minimum uptime that's required of them is about 43 um and that's what's what's charted here in the the kind of meeting of all these lines um for different number of validators now if we add an ev to that uh the actual uptime required is so it's slightly different by the number of validators but it's about 27 so um what's required of validators in terms of uptime has decreased thanks to mev um again whatever that's good about is something that we need to think about more more deeply but um is definitely important um oh me delete that as well oh whatever um all right so the the numbers i guess a quick summary is uh me boost value they yield significantly uh and so as justin says in the tweet that i mentioned earlier more yield means more validators means more security so that's probably a good thing however given the the difference in um between minor revenue that's uh enabled by flashball so this five percent increase in revenue versus here uh something that's much higher uh intuitively even though we have to run the numbers even better uh it's even more important for mev to be extracted in a democratic fashion because as as is mentioned in phil's post this is what is the mev what do stands for um it will create a stronger divide between the validators who extract them even the ones who don't and that's uh very important similarly as as we saw in the the other numbers muv decreases the impact of our validators uptime on a validator awards and mev decreases the lower bound on uptime necessary for validator to make in that positive reward the second bullet point is something that that we took out so ignore that for now um and in terms of next steps for all this modeling um we definitely want to model uh the the the inflation that's caused by the base fee burn in the ip1559 as well as the transaction fees validators can expect and oppose the ip1559 world and we want to include them in those results because the impact of emiv is currently overstated because fees will also play a part in validator yield and that that's what justin showed um similarly we want to we want to chart mev enabled by data yield at different levels of participation and uptime so imperfect validator and a perfect network which is something that pintail charted and that we want to do more work on and i guess we want to release all this work uh shortly and the code behind these numbers as well so that every people can can play with them um so these are kind of next steps related to that so they get this gives maybe a little bit more intuition around um the numbers but there are there are other aspects to um muv and these two that are important to consider um the first one actually thomas a few thank you um the first one is that there are new actors that emerge in east 2 and this is important to keep in mind when you think about mev and the landscape around it um one of these actors are these kind of metapools in a way so if you compare them to ethereum one you have miners and mining pools and that's kind of the dynamic that stops there here we have validators validator pools and aggregators of validator pools that offer services on top such as lido that are first taking derivatives where they connect to several validator pools that you can see below right sticking facilities chorus stir this one and this is interesting because it will shape the mev landscape via soft power because lighter will have a lot of sticking volume involved and they'll be able to have a say in how mev is extracted and also the profit sharing between validator pools and uh ultimately validators themselves so i think it's it's an important uh thing to keep in mind the other important thing to keep in mind when you kind of start building a mental model around maybe viennese too is the new players that emerge um specifically exchanges right and so if you look at the etho and deposit addresses this is taken from beacon beacon chain uh you can see that that crack and binance are very large chunks of validator power and this is interesting because exchanges are not solely in the validator businesses business and uh they also have other regulatory requirements that might influence the type of mvp activity they take part in uh and this is this is important to to keep in mind um that's pretty much pretty much it so yeah looking looking ahead uh to mass i'll give it back to you yeah so soon you'll be able to also play with this uh mev construction within our deployment of ryan is so with that nether mind packages that you're downloading i think uh meet next week ugash is delivering now uh four ninja minds the mev bundles within this ryonese exercise and coming back to how the environment will look after the mev in ethereum one ethereum two so i think that there might be some quite interesting questions like does the market appear because the big validator pools will be actually able to run their own memory operations and maybe start offering to the pool participants information about what fees they charge for this quality of the mev and it's like what their returns are so it's almost like you'll be comparing that like some funds or pension funds exchange traded defense whatever you'll be looking at those numbers is what quality of the financial activity this uh extraction of value happens on the pool that you join on the other hand it's like ethereum one node operators may start acting as this mev managers and say that they are providing those uh quality solutions to maybe smaller validator pools or some independent validators here that's a good question to ask it might be less likely because the independent validators may not follow the privacy requirements for the for the bundles that are included in the mev blocks and this second thing may potentially lead to independent solar validators to be disadvantaged because not being able to capture the mev i think it still remains a bit vague of how exactly those markets will look so great set of open questions to see how that market evolves and a few others that we'll probably once really discuss as we're running out of time but we just want to leave them open here and leave them for you to to follow to follow the links explored opportunities um i think that's what we've prepared for today right there's no other slides even and we're perfectly over time yeah that's a very much we're on time yay uh i guess that's just the last slide to mention where we're this is definitely there you go there's definitely a an open conversation that we're trying to have and as i mentioned these are early numbers and we want to talk more about this so flashbacks has regular community calls we call mev roast and we're gonna have one soon to talk about eth2 and layer two and we also have a research arm to what we're doing and we definitely wanna dive deeper into many of these open questions um and so join us and then on on another minefront um yeah make sure that you play with the with the devnet make sure that you make core developers feel uh feel the chase of the users so thank you so much everyone uh thanks alex thank you for an invitation to global uh thank you carly alex thank you so much i know we are right on time so i'll just maybe do one question um there's a lot of chat on on the timelines which i guess i won't go into right now on shipping this but the one question i want to ask here is uh um it's for both of you um and just the question is right now you have to send your mbv transaction to uh to like three pools that are available um with more validators coming on do you think it'll be harder to get into uh the next validator as a transaction or what does that world look like i i think that's uh like the way the flashback is organized is the flashbots deliver those solutions to be able to connect the searchers with the miners and in the future you'll have flashbots or other operators delivering the same kind of matching of the validators with the with the searchers so this way you won't have to discover those validators that will be uh having the majority of the network you'll be able to to get to that polls and also i think as alex was saying uh there'll be some of this kind of meta pooling which will also uh route the uh the bundles to the validators alex do you want to add anything here no that's that sounds good i mean i i will say um this this is something we want to explore more i think there's like uh mechanics there the economics of it that are still things that uh we have a good idea on and theoretically it makes sense but as we've seen with you know what we've been building so far there's many many points where that breaks and we have to see how things change and so partly what tomas mentioned right like at the rayonism uh to to kind of maybe experiment with that with the dev test net could could be for us a good way to understand that better um and also as i mentioned before it's not only the technical factors but also the the maybe softer factors that are going to exert pressure into how this is going to work and how revenue might be split um and so these are all kind of nested questions absolutely well thank you so much for sharing your insights and uh thanks again for giving this amazing talk we have a lot of excitement that uh everybody's thanking you on on our chat so hope to see you there 