Itai Ashlagi: So
far we talked about markets that are static, many markets have
a dynamic nature including dynamic
matching markets. Here's a list of several
examples like organ allocation, kidney exchange, which I
will talk a lot about today. Online dating, there are several markets for
that to find dates, public housing, foster
care, health care services. A lot of those markets think about how to
ration the supply. There's other
markets that do have prices and matching
does play some role. We still don't know how much. Things like ride-sharing, peer-to-peer markets,
online labor markets. I think there's still a
lot of work to do there in terms of what's the matching. Features that are special
to those markets, they're dynamic in the sense that agents arrive
and match over time and there's also
different matching technology. Some of them have one-way
matches assignments. Some of them bilateral matches we will see in the
kidney exchange today. There's also multi-way
exchanges and even chains. We talked about static
markets where agents are all at the market
at the same time and the market has
some finite horizon and issues to consider
when you think about dynamic matching markets
are how to create a thick marketplace to make
the market attractive. When and not only who to match, waiting is costly for agent in these markets and how much
to intervene in the market. Should we keep it decentralized? How much should we
play a role in it? The search literature is
very related to this. They're studying a lot
of dynamic markets focusing mostly on
decentralized markets. There's two approaches there, starting with a
traditional approach where the traditional search where
people meet randomly and decided to form a match or
not and directed search where matches are triggered
by prices or by wages. There's excellent
surveys about this. Here we're thinking a lot
about how to intervene versus how to do the match, to zoom into their
matching function and interfere in these markets. Something to think about when we're thinking of
design of markets, we need to think about what
the supply and demand is, which is determined a lot by the heterogeneity in the market and the match value
constraints in the market. Sometimes we have
legal constraints as we'll see here today, and also technological
constraints and of course, how to make the
market attractives to get transactions feasible. I'll talk by example using kidney exchange of a
lot of these issues, starting with background
and operational constraints and then we'll talk about what efficiency would
look like if we had a very attractive market
bringing lots of people into it. Then we'll see, we
need to talk about actually the dynamic environment
and see how to match in this world, and then some issues of how to get
people to participate in this kidney exchange. Now I'll conclude with some
final thoughts and some exciting
recent developments. Starting with some background
on kidney transplantation, it's a big problem in
the US and in the world. Transplantation is
the best treatment, usually for end-stage
renal disease and there's a big
shortage of organs in the US for kidney patients who are looking for transplant. There's 110,000 people
on the list currently. Just in 2015, there
were 35,000 people who joining the list and only about 18,000 kidney transplants, a third of them
from living donors. What is the supply and
demand in this market? This is determined by
biological constraints. What determines if a patient
is compatible for a donor is blood type compatibility and also tissue type compatibility? A patient cannot take
a kidney from a donor that does not have a
blood type protein that he himself has. AB patient can take a
kidney from everyone. O patient can take
only from itself. O donor can donate to everyone. We'll see that O patients
are the disadvantage in this market and we'll see the O donors are going
to be in short supply. By tissue type, I mean that
if you have an antibody for, against some antigen
of the donor, you cannot take his kidney and most of us are
low sensitized. We don't have many
antibodies because we haven't gone through a blood transfusion
or we don't take a kidney that got
rejected at some point, that's when we develop
those antibodies and about 10 percent of
the general population are highly sensitized. There's a measure for
this. This is called the panel reactive antibodies, PRA, which measures given
your antibodies and the frequency of antigens
and the population, how likely are you not going
to match a random donor. We mentioned there's
lots of live donation. But if you want to
donate to someone you know and
incompatible to do so, let's open the doors
for an exchange. Here's an example for two-way kidney exchange where there's pair 1 donor
1 and recipient 1 that are incompatible
here because of their blood types and donor 2 and recipient 2 have
the opposite problem. Donor 1 can donate to recipient 2 and donor
2 can donate to recipient 1 if they don't have any antibodies to
them and that's a two-way exchange. There's been efforts to
create clearing houses, to have lots of those incompatible pairs
in order to be able to find matches or exchanges like this.
The first is actually kidney exchange program that involve multiple hospitals in, so some, a little
bit thicker market. It was actually here in New England and there's
some papers to look at the things that we're to think about when you come up
with those clearinghouses. This market has some
legal constraints and before kidney exchange
became very big, there was some need
for change in the law. The National Organ
Transplant Act said that people cannot
take a human organ for valuable consideration and
you can think that getting a kidney from someone
you don't know is some valuable consideration. That was changed so that human organ paired
donation can happen. That is kidney exchange. Some technological
constraints come from incentives and also resources. You want to satisfy
it because you cannot write a contract to force someone to
donate a kidney. You want to organize kidney
exchange, for example, between two pairs such that every pair gets a kidney
before they give a kidney. That means that if you're
organizing a two-way exchange, the two nephrectomies
have to be done at exactly the same time and that means to at least
two surgical teams and at least two surgical rooms and now you can
think about exchange at that larger size
with three pairs or four pairs and that's going to be more and more
difficult to have. In practice, exchanges
are kept short with changes that involve
only incompatible pairs to usually to size
2 or to size 3. One solution to
this came actually from a new source of donation. Sometimes donors
are willing to give their kidney without
expecting anything in return. Those are non-directed donors or altruistic donors, we
sometimes call them. If someone like this shows up, he can donate to someone
on the wait list, but he can also start a chain and we can
organize a chain in a way that every pair can get a kidney before
they give a kidney, even if it's non-simultaneous. It may be that this non-directed donor
donates to Recipient 1 today and Donor 1 and donates
to Recipient 2 tomorrow. If for some reason
this link fails here, this pair is very disappointed, but they still have
both the recipient and the donor to exchange
tomorrow with another pair. The cost is not so high for link breaks if we do this
in a non-simultaneous way. This observation help
a lot to facilitate more transplants and
because they can be longer. The first chain which
after it was done, was published in the New England Journal
of Medicine and also in some public newspaper. This is in People Magazine. This was a chain with 10 pairs. It took almost a year and
actually the last woman here, Heleena McKinney, took her almost a year to continue
the chain afterwards. Here is another chain from 2012. This took about nine months, and this is the 30 pairs. In fact, there's
also a pair here are related and they are compatible pair who we're looking
for a better match. You can get a better
match for someone who is a younger donor or someone
who has a better tissue, their tissues are matching better to yours than
the original donor. Those chains became popular and are facilitating a lot of
the transplants today. Just before we move on to what efficient
exchanges look like, it's convenient to think about the pool as a
compatibility graph, where a circle here or a node is the
incompatible pair and an arrow from this node
to this node means that the donor of this pair can donate to the
patient of this pair. In this graph, the
things are very nice. There is a two-way exchange, there is a three-way
exchange and you can possibly start
a chain here from the non-directed donor that
goes here and you can match everyone even with
very small exchanges. But things are usually
more complicated. There's conflicts or sometimes you cannot match everyone. So those are things
to think about. What do you do with the current
pool? How do you match? That brings me to talk
about efficiency in this market and I'll
start with what would happen if we have a
lot of participation. Remember, we have 100,000
people on the wait list. If we get lots of them to participate with
incompatible donors, maybe we can find for
them matches easily. The question here is, what is the efficiency loss from restricting
cycles to be short? Because that's what we can
do due to the constraints. Should we invest
in infrastructure that allows for long cycles? Who should match the
who in this market? You can do a simple
exercise here by creating a random
compatibility graph based on medical statistics using the distribution
of blood types, distribution of how
sensitized patients are. You can create a graph by
generating n pairs nodes. You create a patient
using the distribution, you create the donor, and
if they are compatible, they don't join the pool and
if they are incompatible, they join the pool. You create like this
n incompatible pairs. Then you can create the links between incompatible
pairs and you have a random compatibility
graph and you can look what will be an efficient match. To analyze this, you can use results from
random graph theory. Here is some very classic
result by Erdos and Renyi. Before I tell you the result, what is a random graph? This is a very abstract notion. There's n nodes and between
every two nodes there is some non-directed link with
probability p independently. The theorem tells you that
any such graph is going to have a perfect
matching if it's when n grows large and if p is
at least this order of log n over n. So you let n grow as long as p is above this, you will find a set of edges or links in
this graph that are disjoint from each other and
going to match everyone. That's what this theorem said. If p is smaller than this, then the graph is too sparse to find the location that is
going to match everyone. In the world of kidney exchange, p does not depend on
the size of the market. It's independent, so it's definitely going to
be above log n over n. Applying those kinds of results you can
look for example. You can start in
generating pairs. You're going to get
some pairs that have an A patient
and an O donor. You're going to get pairs that are O donors and an A patient. Let's limit for a second just for those two
types of pairs. There's going to be more
A-O pairs than O-A pairs, because lots of the A-O pairs, when we generate them, they are compatible to each other and they don't
join the pool. We see only those that have
antibodies to each other. But the O-A pairs,
all of them join. They're not compatible
because of blood type. You can apply this theorem, you can see that
there's going to be a perfect matching such that every A-O is going to
be able to match using just the two-way exchange
to some O-A patients. This is going to be the
long side of the market. This is going to be the short
side over demanded ones. Some of those O patients are
just not going to match. Those O patients are
going to compete to match with O donors
in a large market. You can extend this
now looking at the entire pool, all
the blood types. For example, the O-O pairs, if you have a lot of them, they will be able to
match with each other somehow with just
two-way exchanges. If you look at the entire pool, you can show that you don't
need very large cycles. You can get away with the
cycles of length two or three. If the world is large, the cost of restricting to short-cycle is there's no
cost for it basically. Chains cannot add too much
because chains count can help those unshaded ones,
the under demanded ones, to go, for example, to an O-A pair and
then to A-B pair and then you can go
maybe to the wait list. There's so many people that you can find
someone to match. Chain can increase
by a little bit. One problem that we are seeing and we saw in practice is that 75 percent of the transplants in kidney exchange clearing houses
are done through chains. That brought us to
look more at the data when data started to
became available. What is going on here? Here is some data from two kidney exchange
clearing houses, the National Kidney Registry and the Alliance for
Paired Donation. This is the distribution of how sensitized patients
are in these pool. The PRA, so 95-100, these are patients that have less than 5 percent chance
to match a random donor. Lots of them are very
highly sensitized. Lots of those are
also low sensitized, but many of those low sensitized are
actually belonging to the under-demanded side of the market like the O
patients with A pairs. Those are also hard
to match pairs. If you zoom into the 95-100, you see that lots of those are actually very highly sensitized. They have less than 1
percent chance to match. If you look at some
transplants they've done over the year by the
National Kidney Registry, you see that indeed most of them have been
done through chains. Recently when the market is becoming a
little bit thicker, you are able to do
more and more cycles. So if we do manage to grow this, you will be able to facilitate transplants with small exchange. That bring us to look at
the dynamic market which is we don't have every day so many patients and we
need to think how to match them in this
dynamic environment. In this environment,
again, we want to ask, how efficient is the
market when we match only through two-way cycles
and three-way cycles? How important is
it to use chains? In the dynamic world, we
want to start thinking about what is efficiency when we can think about
things like minimize the average waiting time or
maximize the match rate? You can think about those distributions of
waiting time and so forth. You can also think about not just which
technology are using, but also different policy. When to match people, do you want to
wait, for example, to use a batching policy match every month such
that you accumulate some pairs or do you try to match everyone that
just arrived to the market? That's a greedy policy. You can think about much more sophisticated
matching policy that depend on the
graph structure that you have now and so forth. Let's just think about
the trade-off between greedy policies and batching policies or policies that wait. Suppose you have just those three pairs in the system today, in the pool today, A, B, and C. So you can match
either B to C or B to A. If you match B to C and
the next day D arrives, you might have missed
matching A to B and C to D. If you just waited you could have
done those two matches. There is some tradeoff
here by waiting, you can get maybe more matches. On the other hand,
you are risking maybe the people will either die or harm patients because
they're just waiting longer. So that's a trade-off here. Let's see what
happens in practice in some clearing
houses in the US, there's not just one,
there's a bunch of them. Here's the leading one, the Alliance for
Paired Donation, National Kidney
Registry, for example, both of those experience
different policies for matching with different batches and
they actually moved over time to match daily and
sometimes even more than daily, so really greedily trying
to match you immediately. The UNOS which is responsible for allocating
deceased donors in the US, they also have a kidney
exchange program. They move from monthly
matching to weekly matching. They're matching every
Monday to daily. Netherlands, which doesn't
have a large volume, we're matching every month. You can ask is this daily
match is a good thing, is it because of competition, they're worried that some of these other clearinghouse
would steal their matches, or is it okay, even in an independent world? I'll show you some simulations that we did to help some of those connections
clearinghouse to understand if greedy is good, but let me start giving a model to how to
think about this. It's going to be a
very abstract model with homogenous agents. Agents are going to
arrive over time. Here just one agent arrives
every day but you can think about some Poisson
arrival process or something like that. Every agent that arrives to
the market is going to form a directed link to
every other agent in the market with
probability p independently. That's some assumption
we're making of course. Every agent in the market is going to form a directed
link to their arriving agent. That's the Erdos-Renyi graph
that I told you about with directed links but
it's a dynamic one. I only see the links for agents that are
still in the market. For now, just let's assume that there's no endogenous
departures. That means that everybody leaves the market only when
they get matched. The objective for today is minimizing the
average waiting time, which turns out to be
equivalent to minimize the number of agents in
the pool at steady state. That follows for,
by Little's Law. Little is John
Little here at MIT. The average waiting time of
such a stochastic process is the average number of agents in the market divided by the
arrival rate in the system. We want to think about what
the behavior of the system, what is the waiting
time when p is small. Because when p is large, we are basically back into this thick market and everybody
can match very quickly. Let's start thinking about
just what happens when you allow only bilateral
exchanges between two agents. To form a link between
just two agents, the bilateral exchange is
going to be p squared, a link in each direction. Let's think just about
the steady state. What's going to be the
average waiting time in a policy that
reaches a steady state? Every policy that
reaches a steady state, a cycle is formed at each
period with probability half. That's because the
arrival rate to the system is one per period. The number of agents in the system is going to be
roughly one over p squared. Every penny policy that
reaches a steady state, you can say that this has to be at least the average waiting
time and you can show also that a greedy policy will achieve roughly this
average waiting time, some constant over p squared. What about if you allow
three-way cycles? How does the waiting
time change then? Here let's just think
about batching policy. We'll see that just the simple
batching policy is already going to do better than
the two-way matches. Let's think about a
simple batching policy that for every batch it's going to clear the
market completely. Everybody is going to be
matched using three-way cycles. What should the bad sides
be in such a policy? If you have n pairs
in the market, the number of triangles, three-way cycles is
going to be roughly n cubed times p cubed. Even if you did roughly,
you'll need a bit more, but roughly n over
three triangles, you need them to be
disjoint in order to match everyone in all
of those n pairs. That means that n should be roughly one over p
to the three-halves, and if every batch of size one over p to the
three-halves clears, then that's also the
average waiting time. This is similar results like
Erdos Renyi only now for a three-way cycles
instead of just links. It turns out that greedy also achieves this average
waiting time. A batch in policy for
three-way does much better than any two-ways policy. We see a gain from there, and what about the chain? Imagine you had a day 0, an altruistic donor
who can start a chain and let's refine this foreign length
chain and Donor 4 cannot continue
this chain anymore. He can only continue it when some new pair arrives and he
can donate to that patient, and to which case, we continue the chain as much as
possible, and so forth. For any patient, we know that the time that
he needs to wait as an expectation at least
one over p because to math to have a form a
link to that patient is probability p. The average
waiting time is going to be at least one over p and you can show that greedy achieves this average
waiting time. Let's put this together just by using even
a single chain, you get a much better
waiting time than using two or three-way cycles
than two-way cycles. The intuition again
is coming from the idea that it's going to
be very hard to close cycles, but continuing chains and not forcing them to close
is much easier. Here's some simulation
with synthetic data that you get a real gain, this is the average
waiting time from going from two-ways to three-ways, and to change you
get a little bit more improvement in
terms of waiting. We did some simulations. Let me skip this. No. Actually, I'll say, what if you had a
little bit more heterogeneity to the market? Suppose you have easy
and hard to match. Remember the distribution of
how sensitized patients are. Some patients are going to be compatible with a donor with very low probability and
some of them will be compatible with very
high probability. How does the world looks then? If now we do only
bilateral matches and matching through chains, the average waiting time is going to depend
on the ratio between easy and hard-to-match patients. You see when the ratio between
them is less than half, then doing bilateral matches
is actually not too costly. But if there's more highly sensitized people in the market, it's getting really
important to do chain. You see their average
reading time or just bilateral is jumping very fast. We've done some real
simulation with real data using
two-way, three-ways, and chains altogether,
similar to practices in the
National Kidney Registry and the Alliance for
Paired Donation. Actually, here we also incorporated departures
that we estimated. What you see here is we experimented with is
how often do you match? Here's you match every two days, every four days, and so
forth, and actually, you'll find if you look at high sensitized patients or
low sensitized patients, the number of matches goes
down if you wait more. Part of this is because of the departure rate but
it's pretty robust. Sometimes it goes up a
little, but not too much, or if the departure
rate is very small, then it takes a long time
until it really goes up. The average waiting time goes up in all of these scenarios. We found out it's
pretty robust to do greedy, at least
in this setting. The question is what happens if you're going to bring more easy to match
pairs into the system, or what's going to
happen if you're in more and highly sensitized ones you are going to
join the system? Easy-to-match are just going
to help everybody to match. What you see here on the y-axis is the average waiting time for highly sensitized patient. If you bring more
easy to match people, the average waiting time
if everybody goes down. If you bring more highly
sensitized patients into the system, then there's some place that
it starts jumping up to. As long as the Theta h is
the same order of Theta e, which their arrival
rates are the same. Using just bilateral
matches is not so bad. But after that, you really
want to start using chains. That's the area that highly
sensitized people are really competing to match
with easy to match one. If you're going to
continue this graph, eventually it's
going to go down. You're just bringing so
many people that even highly sensitized will be able
to match with each other. This region they're
really competing to match with easy to match ones
in order to match fast. Some remarks we found that greedy matching is doing
well in this setting. I'll comment a bit
about other settings, in the world of kidney exchange. The matching technology we found that plays
a big difference. We really wanted to move to
three-way cycles and chains. For some limitations,
in practice, match offers do not always
translate to transplants. Sometimes you get an offer
and you say no to that offer, or there's sometimes needs to do a real blood test and
that blood test fails, so there's some actual failures in practice to think about. Another issue is, did we really reach the steady
state in this market? Some issues of computation, finding a long chain in a pool, it turns out to be
an NP-Hard problem and we offer some solutions. Usually those problems
we solve very fast, but you need to develop some algorithms and able to
solve every instance fast. One question to think about, how to thicken the
market to bring more of those easy to match pairs
including old donors. I told you that
greedy mechanisms work well in kidney exchange. There is recent work by Akbarpour, Li, and Oveis Gharan that look at a very
similar model. They ask the question, what if we knew the departure times when people
die in this market. Then they find that actually if you know that
you have this information, you want to exploit
it and not met someone until he really is
going to leave the market. There's recent exciting work about trade-offs between
quality and thickness. In other markets when there's a lot more heterogeneity
and preferences. For example, Leshno thinks about allocating public housing
when people have preferences, whether they want to
go to the north of the city or to the
south of the city. Every option is
acceptable to everyone, but people have
real preferences. In those kind of markets,
the optimal policies are really to ration
the supply somehow to increase match quality. This similar questions
have been asked in financial markets when to match, how to match, and dynamic
mechanism design. There's a lot of
revenue management. People think a lot about
how to ration goods. The last thing I
want to talk about is incentives for participation. In marketplaces in general, the participation is voluntary, especially when you can
transact outside the market. It turns out that hospitals, there was a lot of
efforts to create clearinghouses and
kidney exchange and bringing hospitals
together to share their data to find exchanges. It turns out that hospitals
have become players and starting to do internal
matches between their pairs. They only show to the
Clearinghouse those that are very hard to match because who
are they matching at home? They are matching those that
are very easy to match. Just to give you an example, think about a hospital that has a_1 and a_2 and they can form a two-way exchange
between a_1 and a_2. If they show them to
the Clearinghouse, and there's another pair of
B from a different hospital, and B is a child or a
sensitized patient. Then the clearinghouse
might choose this two-way and then
a_2 is not matching. This hospital a is
lost a transplant, this a_2 is not matched even
though they could have. That's one example,
is this happening, this example that is
going to happen often. We wrote something about this, but let me give you
another example. Look at this A-O
pairs and O-A pairs. Let's say a is the
same hospital now, one of them is an A-O pair and one of them is an O-A pair. Remember those O
patients are going to compete for O donors. If the Clearinghouse
is just going to match somehow randomly those
A-O pairs to O-A pairs, this a_2 guy might
not be matched because all of them
are competing to match to the scarce number
of A-O pairs. Then this a_2 will
not be a match. Hospitals have become players. Indeed, Mike Rees
was the Director of The Alliance  for
Paired Donation writes that competing matches at home centers is becoming a
real problem unless it's mandated or I'm not sure if we're going
to be able to create a national system. We need to think about how
to bring everybody together to get more matches. We're trying to estimate
now the inefficiencies from free-riding on kidney exchange clearing
houses by hospitals. One attempt by the National
Kidney Registry who also realize this
was to come up with some form that hospitals who participate in the National
Kidney Registry will sign that they're putting
all their pairs in. If they do that, the
National Kidney Registry is going to waive their
annual membership fee. There's some relatively
smaller membership, but still it's not negligible.
But that didn't work. It's also hard to monitor if your really participating or not and centers also didn't
want to sign this form. We wrote a paper about how to design mechanisms
that are going to incentivize you to participate and see and also
analyze those mechanism are going to have a loss from enforcing those
participation constraints. The main finding there
is to come up with something that is a
frequent flyer mechanisms that gives priority to hospitals that are
participating well. All patients of
hospitals that are better participators
are going to be more likely to be matched than hospitals that don't
participate with. Now something like this has
started recently in 2015, the National Kidney
Registry started something called the Credit
Liquidity Program. In the rules they
have that matches are selected based on the number of transplants they can find, plus they're giving
prioritization to highly sensitized
patient children, non-directed donors who
have some timeframe. But they also give
priority to patients at centers that have
high liquidity. How is your liquidity decided? They give points according to the patients or the pairs
you match in the system. If you match an A-O pair
which is over demanded pair, you get a 100 points. This is just example
for numbers. If you match O-A pair which
is an under demanded pair, you lose a 100 points and different types
get different points. There's a question here, what is the right points
here in order to get better participation
in more matches? Let me conclude with some recent developments
and final comments. I mentioned some
words by Akbarpour, Li, and Oveis Gharan and trade-offs between
quality and thickness. The paper by Baccara, Lee, and Yariv also
goes further and ask, what's the difference between centralized marketplaces and
decentralized marketplaces? How much should we
really intervene? I think there's still a lot
to do in that direction. There's also dynamics. It's not a dynamic matching market like
we're thinking here, but a lot of dynamics in when you're thinking about
school choice assignment. There's second round assignments and later assignments for those who weren't assigned
or in the labor markets. [inaudible] Narita here from
MIT is thinking about how to overcome inefficiency due to changes in preferences
between those assignments. Some final comments we found. When we think about
market design, we need to think about the
operational constraints. We want to ask, can
we gain by improving the matching policies,
matching technologies? How much intervention is needed? What are optimal policies
in dynamic environments? Sometimes it's
greedy like we saw in the kidney exchange, but that's not always true. I will leave those
final comments here and take questions
if there are any. 